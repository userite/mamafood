// Internationalization (i18n) for ĞœĞĞœĞĞ¤ĞĞĞ”
const translations = {
    'bg': {
        // App title
        appName: 'ĞœĞĞœĞĞ¤ĞĞĞ”',
        addNew: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸ Ğ½Ğ¾Ğ² Ğ·Ğ°Ğ¿Ğ¸Ñ',
        
        // Main sections
        currentPortions: 'Ğ¢ĞµĞºÑƒÑ‰Ğ¸ Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ğ¸',
        expiredPortions: 'Ğ˜Ğ·Ñ‚ĞµĞºĞ»Ğ¸ Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ğ¸',
        statistics: 'Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°',
        totalPortions: 'ĞĞ±Ñ‰Ğ¾ Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ğ¸',
        active: 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸',
        expiringSoon: 'Ğ˜Ğ·Ñ‚Ğ¸Ñ‡Ğ°Ñ‚ ÑĞºĞ¾Ñ€Ğ¾',
        noRecords: 'ĞÑĞ¼Ğ° Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸. Ğ”Ğ¾Ğ±Ğ°Ğ²ĞµÑ‚Ğµ Ğ¿ÑŠÑ€Ğ²Ğ° Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ñ.',
        
        // Record status
        statusExpired: 'Ğ˜Ğ·Ñ‚ĞµĞºĞ»Ğ°',
        statusWarning: 'Ğ˜Ğ·Ñ‚Ğ¸Ñ‡Ğ° ÑĞºĞ¾Ñ€Ğ¾!',
        statusOK: 'Ğ“Ğ¾Ğ´Ğ½Ğ°',
        
        // Form labels
        addPortion: 'Ğ”Ğ¾Ğ±Ğ°Ğ²ÑĞ½Ğµ Ğ½Ğ° Ğ½Ğ¾Ğ²Ğ° Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ñ',
        editPortion: 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ñ',
        amountLabel: 'ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ (ml)',
        situationLabel: 'Ğ¡Ğ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ',
        datetimeLabel: 'Ğ”Ğ°Ñ‚Ğ° Ğ¸ Ñ‡Ğ°Ñ Ğ½Ğ° Ğ¸Ğ·Ñ†ĞµĞ¶Ğ´Ğ°Ğ½Ğµ',
        notesLabel: 'Ğ‘ĞµĞ»ĞµĞ¶ĞºĞ¸ (Ğ¿Ğ¾ Ğ¸Ğ·Ğ±Ğ¾Ñ€)',
        notesPlaceholder: 'Ğ”Ğ¾Ğ¿ÑŠĞ»Ğ½Ğ¸Ñ‚ĞµĞ»Ğ½Ğ¸ Ğ±ĞµĞ»ĞµĞ¶ĞºĞ¸...',
        
        // Form buttons
        save: 'Ğ—Ğ°Ğ¿Ğ°Ğ·Ğ¸',
        cancel: 'ĞÑ‚ĞºĞ°Ğ·',
        confirmChangeCode: 'Ğ¡Ğ¸Ğ³ÑƒÑ€Ğ½Ğ¸ Ğ»Ğ¸ ÑÑ‚Ğµ? Ğ¢Ğ¾Ğ²Ğ° Ñ‰Ğµ ÑĞ¼ĞµĞ½Ğ¸ Ğ±Ğ°Ğ·Ğ°Ñ‚Ğ° Ğ´Ğ°Ğ½Ğ½Ğ¸.',
        enterChildCode: 'Ğ’ÑŠĞ²ĞµĞ´ĞµÑ‚Ğµ ĞºĞ¾Ğ´ Ğ·Ğ° ÑÑŠÑ‰ĞµÑÑ‚Ğ²ÑƒĞ²Ğ°Ñ‰Ğ° Ğ±Ğ°Ğ·Ğ°, Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ°Ğ·Ğ½Ğ¾ Ğ·Ğ° Ğ½Ğ¾Ğ²Ğ°:',
        export: 'Ğ•ĞºÑĞ¿Ğ¾Ñ€Ñ‚',
        import: 'Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚',
        
        // Record info
        pumped: 'Ğ˜Ğ·Ñ†ĞµĞ´ĞµĞ½Ğ°',
        prepared: 'ĞŸÑ€Ğ¸Ğ³Ğ¾Ñ‚Ğ²ĞµĞ½Ğ°',
        temperature: 'Ğ¢ĞµĞ¼Ğ¿ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ğ°',
        deadline: 'Ğ¡Ñ€Ğ¾Ğº',
        expiryLabel: 'Ğ¡Ñ€Ğ¾Ğº Ğ½Ğ° Ğ³Ğ¾Ğ´Ğ½Ğ¾ÑÑ‚',
        unknown: 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°',
        
        // Actions
        edit: 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ°Ğ¹',
        delete: 'Ğ˜Ğ·Ñ‚Ñ€Ğ¸Ğ¹',
        
        // Storage conditions
        conditions: {
            'room': { name: 'Ğ¢Ğ¾ĞºÑƒ-Ñ‰Ğ¾ Ğ¸Ğ·Ñ†ĞµĞ´ĞµĞ½Ğ°', temp: 'Ğ´Ğ¾ 25Â°C', duration: 'Ğ´Ğ¾ 4 Ñ‡ (2Ñ‡ Ğ¿Ñ€ĞµĞ¿Ğ¾Ñ€ÑŠÑ‡Ğ¸Ñ‚ĞµĞ»Ğ½Ğ¾)' },
            'fridge': { name: 'Ğ’ Ñ…Ğ»Ğ°Ğ´Ğ¸Ğ»Ğ½Ğ¸Ğº', temp: '0-4Â°C', duration: 'Ğ´Ğ¾ 4 Ğ´Ğ½Ğ¸ (72Ñ‡)' },
            'freezer': { name: 'Ğ¤Ñ€Ğ¸Ğ·ĞµÑ€', temp: '-18Â°C', duration: 'Ğ´Ğ¾ 6 Ğ¼ĞµÑĞµÑ†Ğ°' },
            'cooled': { name: 'ĞÑ…Ğ»Ğ°Ğ´ĞµĞ½Ğ° (Ğ¾Ñ‚ Ñ„Ñ€Ğ¸Ğ·ĞµÑ€)', temp: '0-4Â°C', duration: 'Ğ´Ğ¾ 2 Ñ‡ (Ğ½ĞµĞ¿Ğ¾Ğ´Ğ³Ñ€ÑÑ‚Ğ°)' },
            'thawed': { name: 'Ğ Ğ°Ğ·Ğ¼Ñ€Ğ°Ğ·ĞµĞ½Ğ°', temp: 'Ñ…Ğ»Ğ°Ğ´Ğ¸Ğ»Ğ½Ğ¸Ğº', duration: 'Ğ´Ğ¾ 24 Ñ‡' },
            'cooler-bag': { name: 'Ğ¥Ğ»Ğ°Ğ´Ğ¸Ğ»Ğ½Ğ° Ñ‡Ğ°Ğ½Ñ‚Ğ°', temp: '0-4Â°C', duration: 'Ğ´Ğ¾ 24 Ñ‡' },
            'heated': { name: 'Ğ—Ğ°Ğ³Ñ€ÑÑ‚Ğ°', temp: 'ÑÑ‚Ğ°Ğ¹Ğ½Ğ°', duration: 'Ğ´Ğ¾ 1 Ñ‡ (Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑĞ²Ğ°Ğ¹ Ğ²Ñ‚Ğ¾Ñ€Ğ¸ Ğ¿ÑŠÑ‚!)' },
            'taken-out': { name: 'Ğ˜Ğ·Ğ²Ğ°Ğ´ĞµĞ½Ğ° Ğ½ĞµĞ¿Ğ¾Ğ´Ğ³Ñ€ÑÑ‚Ğ°', temp: 'ÑÑ‚Ğ°Ğ¹Ğ½Ğ°', duration: 'Ğ´Ğ¾ 2 Ñ‡' },
            'after-drinking': { name: 'ĞÑÑ‚Ğ°Ñ‚ÑŠĞº ÑĞ»ĞµĞ´ Ğ¿Ğ¸ĞµĞ½Ğµ', temp: 'ÑÑ‚Ğ°Ğ¹Ğ½Ğ°', duration: 'Ğ´Ğ¾ 1 Ñ‡ (Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸Ğ·Ñ…Ğ²ÑŠÑ€Ğ»Ğ¸)' },
            'cooler-bag-breast': { name: 'ĞÑ…Ğ»Ğ°Ğ´ĞµĞ½Ğ° Ğ² Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ğ½ĞºĞ°', temp: '0-4Â°C', duration: 'Ğ´Ğ¾ 24 Ñ‡' },
            'formula-prepared': { name: 'ĞŸÑ€Ğ¸Ğ³Ğ¾Ñ‚Ğ²ĞµĞ½Ğ° (Ğ½ĞµĞ¿Ğ¸Ğ¿Ğ½Ğ°Ñ‚Ğ°)', temp: 'Ğ´Ğ¾ 25Â°C', duration: 'Ğ´Ğ¾ 2 Ñ‡ (Ğ´Ğ°Ğ¹ Ğ²ĞµĞ´Ğ½Ğ°Ğ³Ğ° Ğ°ĞºĞ¾ Ğ¼Ğ¾Ğ¶Ğµ)' },
            'formula-fridge': { name: 'Ğ’ Ñ…Ğ»Ğ°Ğ´Ğ¸Ğ»Ğ½Ğ¸Ğº (Ğ½ĞµĞ¿Ğ¸Ğ¿Ğ½Ğ°Ñ‚Ğ°)', temp: '0-4Â°C', duration: 'Ğ´Ğ¾ 24 Ñ‡ (Ğ² Ğ·Ğ°Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾ ÑˆĞ¸ÑˆĞµ)' },
            'formula-baby-drank': { name: 'Ğ‘ĞµĞ±Ğµ Ğ¿Ğ¸Ğ»Ğ¾', temp: 'ÑÑ‚Ğ°Ğ¹Ğ½Ğ°', duration: '1 Ñ‡ Ğ¼Ğ°ĞºÑ (Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸Ğ·Ñ…Ğ²ÑŠÑ€Ğ»Ğ¸, Ğ½Ğµ Ğ² Ñ…Ğ»Ğ°Ğ´.)' },
            'formula-warmed-once': { name: 'Ğ—Ğ°Ñ‚Ğ¾Ğ¿Ğ»ĞµĞ½Ğ° Ğ²ĞµĞ´Ğ½ÑŠĞ¶', temp: 'â€”', duration: 'Ğ²ĞµĞ´Ğ½Ğ°Ğ³Ğ° (Ğ½Ğµ Ğ¿Ñ€ĞµÑ‚Ğ¾Ğ¿Ğ»ÑĞ¹!)' },
            'formula-powder-opened': { name: 'ĞÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ° ĞºÑƒÑ‚Ğ¸Ñ (ÑÑƒÑ…Ğ°)', temp: 'ÑÑ‚Ğ°Ğ¹Ğ½Ğ°, ÑÑƒÑ…Ğ¾', duration: 'Ğ´Ğ¾ 30 Ğ´Ğ½Ğ¸ (Ğ½Ğµ Ğ² Ñ…Ğ»Ğ°Ğ´.)' },
            'formula-powder-sealed': { name: 'ĞĞµĞ¾Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ° ĞºÑƒÑ‚Ğ¸Ñ (ÑÑƒÑ…Ğ°)', temp: 'ÑÑ‚Ğ°Ğ¹Ğ½Ğ°', duration: '1-2 Ğ³Ğ¾Ğ´Ğ¸Ğ½Ğ¸ (Ğ´Ğ¾ ÑÑ€Ğ¾ĞºĞ°)' }
        },
        
        // Groups
        groupBreastMilk: 'ğŸ¼ ĞšÑŠÑ€Ğ¼Ğ°',
        groupFormula: 'ğŸ¥¤ Ğ˜Ğ·ĞºÑƒÑÑ‚Ğ²ĞµĞ½Ğ¾ Ğ¼Ğ»ÑĞºĞ¾',
        
        // Confirmations
        confirmDelete: 'Ğ¡Ğ¸Ğ³ÑƒÑ€Ğ½Ğ¸ Ğ»Ğ¸ ÑÑ‚Ğµ, Ñ‡Ğµ Ğ¸ÑĞºĞ°Ñ‚Ğµ Ğ´Ğ° Ğ¸Ğ·Ñ‚Ñ€Ğ¸ĞµÑ‚Ğµ Ñ‚Ğ¾Ğ·Ğ¸ Ğ·Ğ°Ğ¿Ğ¸Ñ?',
        
        // Time units
        hour: 'Ñ‡',
        day: 'Ğ´',
        month: 'Ğ¼'
    },
    
    'en': {
        // App title
        appName: 'MAMAFOOD',
        addNew: 'Add new record',
        
        // Main sections
        currentPortions: 'Current Portions',
        expiredPortions: 'Expired Portions',
        statistics: 'Statistics',
        totalPortions: 'Total Portions',
        active: 'Active',
        expiringSoon: 'Expiring Soon',
        noRecords: 'No records. Add first portion.',
        
        // Record status
        statusExpired: 'Expired',
        statusWarning: 'Expiring Soon!',
        statusOK: 'OK',
        
        // Form labels
        addPortion: 'Add New Portion',
        editPortion: 'Edit Portion',
        amountLabel: 'Amount (ml)',
        situationLabel: 'Situation',
        datetimeLabel: 'Date and Time',
        notesLabel: 'Notes (optional)',
        notesPlaceholder: 'Additional notes...',
        
        // Form buttons
        save: 'Save',
        cancel: 'Cancel',
        confirmChangeCode: 'Are you sure? This will change the database.',
        enterChildCode: 'Enter code for existing database, or leave empty for new:',
        export: 'Export',
        import: 'Import',
        
        // Record info
        pumped: 'Pumped',
        prepared: 'Prepared',
        temperature: 'Temperature',
        deadline: 'Deadline',
        expiryLabel: 'Expiry Date',
        unknown: 'Unknown',
        
        // Actions
        edit: 'Edit',
        delete: 'Delete',
        
        // Storage conditions
        conditions: {
            'room': { name: 'Just Pumped', temp: 'up to 25Â°C', duration: 'up to 4h (2h recommended)' },
            'fridge': { name: 'In Fridge', temp: '0-4Â°C', duration: 'up to 4 days (72h)' },
            'freezer': { name: 'Freezer', temp: '-18Â°C', duration: 'up to 6 months' },
            'cooled': { name: 'Cooled (from freezer)', temp: '0-4Â°C', duration: 'up to 2h (not heated)' },
            'thawed': { name: 'Thawed', temp: 'fridge', duration: 'up to 24h' },
            'cooler-bag': { name: 'Cooler Bag', temp: '0-4Â°C', duration: 'up to 24h' },
            'heated': { name: 'Heated', temp: 'room temp', duration: 'up to 1h (don\'t heat twice!)' },
            'taken-out': { name: 'Taken Out (not heated)', temp: 'room temp', duration: 'up to 2h' },
            'after-drinking': { name: 'Remainder After Drinking', temp: 'room temp', duration: 'up to 1h (then discard)' },
            'cooler-bag-breast': { name: 'Cooled in Cooler Bag', temp: '0-4Â°C', duration: 'up to 24h' },
            'formula-prepared': { name: 'Prepared (untouched)', temp: 'up to 25Â°C', duration: 'up to 2h (give immediately if possible)' },
            'formula-fridge': { name: 'In Fridge (untouched)', temp: '0-4Â°C', duration: 'up to 24h (in closed bottle)' },
            'formula-baby-drank': { name: 'Baby Drank', temp: 'room temp', duration: '1h max (then discard, not in fridge)' },
            'formula-warmed-once': { name: 'Warmed Once', temp: 'â€”', duration: 'immediately (don\'t reheat!)' },
            'formula-powder-opened': { name: 'Opened Canister (powder)', temp: 'room temp, dry', duration: 'up to 30 days (not in fridge)' },
            'formula-powder-sealed': { name: 'Unopened Canister (powder)', temp: 'room temp', duration: '1-2 years (until expiry date)' }
        },
        
        // Groups
        groupBreastMilk: 'ğŸ¼ Breast Milk',
        groupFormula: 'ğŸ¥¤ Formula',
        
        // Confirmations
        confirmDelete: 'Are you sure you want to delete this record?',
        
        // Time units
        hour: 'h',
        day: 'd',
        month: 'm'
    }
};

// Current language
let currentLanguage = localStorage.getItem('mamafood_language') || 'bg';

// Translation function
function t(key) {
    return translations[currentLanguage][key] || key;
}

// Change language - will be overridden by app.js
function changeLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('mamafood_language', lang);
    updateUI();
}

// Make changeLanguage globally available
window.changeLanguageBase = changeLanguage;

// Update all UI elements
function updateUI() {
    // Update dynamic elements
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = t(key);
    });
    
    // Update placeholders
    const placeholders = document.querySelectorAll('[data-i18n-placeholder]');
    placeholders.forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        el.placeholder = t(key);
    });
    
    // Update options
    updateSelectOptions();
    
    // Update datetime input lang attribute and format hint
    const datetimeInput = document.getElementById('datetime');
    const datetimeFormatHint = document.getElementById('datetimeFormatHint');
    if (datetimeInput) {
        const currentLang = typeof currentLanguage !== 'undefined' ? currentLanguage : (localStorage.getItem('mamafood_language') || 'bg');
        datetimeInput.setAttribute('lang', currentLang === 'en' ? 'en-US' : 'bg-BG');
        // Update format hint
        if (datetimeFormatHint) {
            datetimeFormatHint.textContent = currentLang === 'en' ? 'Format: mm/dd/yyyy' : 'Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: Ğ´Ğ´.Ğ¼Ğ¼.Ğ³Ğ³Ğ³Ğ³';
        }
        // Force re-render of the input value to update format
        if (datetimeInput.value) {
            const currentValue = datetimeInput.value;
            datetimeInput.value = '';
            setTimeout(() => {
                datetimeInput.value = currentValue;
            }, 10);
        }
    }
    
    // Re-render records if function exists
    if (typeof renderRecords === 'function') {
        renderRecords();
    }
    
    // Update modal title if add/edit
    if (typeof openModalForAdd === 'function' && typeof openModalForEdit === 'function') {
        // Just re-render, modal will update when opened
    }
}

// Update select options
function updateSelectOptions() {
    const situationSelect = document.getElementById('situation');
    if (!situationSelect) return;
    
    const conds = t('conditions');
    
    situationSelect.innerHTML = `
        <option value="">${t('situationLabel')}</option>
        <optgroup label="${t('groupBreastMilk')}">
            <option value="room">ğŸ  ${conds.room.name} | ${conds.room.temp} | ${conds.room.duration}</option>
            <option value="fridge">ğŸ§Š ${conds.fridge.name} | ${conds.fridge.temp} | ${conds.fridge.duration}</option>
            <option value="freezer">â„ï¸ ${conds.freezer.name} | ${conds.freezer.temp} | ${conds.freezer.duration}</option>
            <option value="cooled">ğŸ§Š ${conds.cooled.name} | ${conds.cooled.temp} | ${conds.cooled.duration}</option>
            <option value="thawed">ğŸ’§ ${conds.thawed.name} | ${conds.thawed.temp} | ${conds.thawed.duration}</option>
            <option value="cooler-bag">ğŸ’ ${conds['cooler-bag'].name} | ${conds['cooler-bag'].temp} | ${conds['cooler-bag'].duration}</option>
            <option value="heated">ğŸ”¥ ${conds.heated.name} | ${conds.heated.temp} | ${conds.heated.duration}</option>
            <option value="taken-out">ğŸŸ¡ ${conds['taken-out'].name} | ${conds['taken-out'].temp} | ${conds['taken-out'].duration}</option>
            <option value="after-drinking">ğŸ”´ ${conds['after-drinking'].name} | ${conds['after-drinking'].temp} | ${conds['after-drinking'].duration}</option>
            <option value="cooler-bag-breast">ğŸ’ ${conds['cooler-bag-breast'].name} | ${conds['cooler-bag-breast'].temp} | ${conds['cooler-bag-breast'].duration}</option>
        </optgroup>
        <optgroup label="${t('groupFormula')}">
            <option value="formula-prepared">ğŸŸ¢ ${conds['formula-prepared'].name} | ${conds['formula-prepared'].temp} | ${conds['formula-prepared'].duration}</option>
            <option value="formula-fridge">ğŸ”µ ${conds['formula-fridge'].name} | ${conds['formula-fridge'].temp} | ${conds['formula-fridge'].duration}</option>
            <option value="formula-baby-drank">ğŸ”´ ${conds['formula-baby-drank'].name} | ${conds['formula-baby-drank'].temp} | ${conds['formula-baby-drank'].duration}</option>
            <option value="formula-warmed-once">ğŸŸ¡ ${conds['formula-warmed-once'].name} | ${conds['formula-warmed-once'].temp} | ${conds['formula-warmed-once'].duration}</option>
            <option value="formula-powder-opened">ğŸŸ¡ ${conds['formula-powder-opened'].name} | ${conds['formula-powder-opened'].temp} | ${conds['formula-powder-opened'].duration}</option>
            <option value="formula-powder-sealed">ğŸŸ£ ${conds['formula-powder-sealed'].name} | ${conds['formula-powder-sealed'].temp} | ${conds['formula-powder-sealed'].duration}</option>
        </optgroup>
    `;
}

// ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ¿Ğ¾Ğ¿ÑŠĞ»Ğ²Ğ°Ğ½Ğµ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ñ€ĞµĞ¶Ğ´Ğ°Ğ½Ğµ
(function() {
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(updateSelectOptions, 50);
        });
    } else {
        setTimeout(updateSelectOptions, 50);
    }
})();
