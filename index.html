<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4A90E2">
    <meta name="description" content="–ú–ê–ú–ê–§–û–û–î - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞ —Å–ª–µ–¥–µ–µ–Ω–µ –Ω–∞ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –∫—ä—Ä–º–∞">
    <title>–ú–ê–ú–ê–§–û–û–î</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üçº</text></svg>">
    <script src="i18n.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 data-i18n="appName">üçº –ú–ê–ú–ê–§–û–û–î</h1>
            </div>
            <div class="header-right">
                <button class="btn-child-code" onclick="showChildCode()" title="–ö–æ–¥ –Ω–∞ –¥–µ—Ç–µ—Ç–æ" id="btnChildCode">
                    üë∂
                </button>
                <div class="lang-buttons">
                    <button class="btn-lang" onclick="changeLanguage('bg')" title="–ë—ä–ª–≥–∞—Ä—Å–∫–∏">bg</button>
                    <button class="btn-lang" onclick="changeLanguage('en')" title="English">en</button>
                </div>
                <button class="btn-install" id="btnInstall" onclick="showInstallInstructions()" title="Add to Home Screen" style="display: none;">
                    üì±
                </button>
                <button class="btn-lang" id="btnPushStatus" onclick="testPush()" title="Push notifications" style="display: inline-flex;">üîî</button>
                <button class="btn-refresh" id="btnRefresh" onclick="refreshData()" title="–û–ø—Ä–µ—Å–Ω–∏ –¥–∞–Ω–Ω–∏—Ç–µ">‚ü≥</button>
                <button class="btn-add" id="btnAdd" aria-label="–î–æ–±–∞–≤–∏ –Ω–æ–≤ –∑–∞–ø–∏—Å">+</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- –†–∞–∑–¥–µ–ª –∑–∞ –∫—ä—Ä–º–∞ -->
            <div id="milk-section">
                <!-- –ó–∞–ø–∏—Å–∏ -->
                <section class="records-section" id="recordsSection">
                    <h2 data-i18n="currentPortions">–¢–µ–∫—É—â–∏ –ø–æ—Ä—Ü–∏–∏</h2>
                    <div id="recordsList" class="records-list">
                        <!-- Records will be dynamically inserted here -->
                    </div>
                    <p class="empty-state" id="emptyState" data-i18n="noRecords">–ù—è–º–∞ –∑–∞–ø–∏—Å–∏. –î–æ–±–∞–≤–µ—Ç–µ –ø—ä—Ä–≤–∞ –ø–æ—Ä—Ü–∏—è.</p>
                </section>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <section class="stats-section">
                <h3 data-i18n="statistics">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number" id="totalRecords">0</span>
                        <span class="stat-label" data-i18n="totalPortions">–û–±—â–æ –ø–æ—Ä—Ü–∏–∏</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="activeRecords">0</span>
                        <span class="stat-label" data-i18n="active">–ê–∫—Ç–∏–≤–Ω–∏</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="expiringRecords">0</span>
                        <span class="stat-label" data-i18n="expiringSoon">–ò–∑—Ç–∏—á–∞—Ç —Å–∫–æ—Ä–æ</span>
                    </div>
                </div>
                </section>
            </div>
        </main>

        <!-- Modal –∑–∞ –¥–æ–±–∞–≤—è–Ω–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ -->
        <div class="modal" id="recordModal">
            <div class="modal-content">
                <button class="modal-close" id="modalClose">&times;</button>
                <h2 id="modalTitle" data-i18n="addPortion">–î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤–∞ –ø–æ—Ä—Ü–∏—è</h2>
                <form id="recordForm" class="record-form">
                    <div class="form-group">
                        <label for="amount" data-i18n="amountLabel">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (ml)</label>
                        <input type="number" id="amount" name="amount" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="situation" data-i18n="situationLabel">–°–∏—Ç—É–∞—Ü–∏—è</label>
                        <select id="situation" name="situation" required>
                            <option value=""></option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="datetime" data-i18n="datetimeLabel">–î–∞—Ç–∞ –∏ —á–∞—Å –Ω–∞ –∏–∑—Ü–µ–∂–¥–∞–Ω–µ</label>
                        <input type="datetime-local" id="datetime" name="datetime" required>
                    </div>

                    <div class="form-group">
                        <label for="notes" data-i18n="notesLabel">–ë–µ–ª–µ–∂–∫–∏ (–ø–æ –∏–∑–±–æ—Ä)</label>
                        <textarea id="notes" name="notes" rows="3" data-i18n-placeholder="notesPlaceholder"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" data-i18n="save">–ó–∞–ø–∞–∑–∏</button>
                        <button type="button" class="btn btn-secondary" id="btnCancel" data-i18n="cancel">–û—Ç–∫–∞–∑</button>
                    </div>

                    <input type="hidden" id="recordId" name="recordId">
                </form>
            </div>
        </div>
        
        <!-- Install Instructions Modal -->
        <div class="modal" id="installModal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeInstallModal()">&times;</button>
                <h2 id="installTitle">–î–æ–±–∞–≤–∏ –∫—ä–º –Ω–∞—á–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω</h2>
                <div id="installInstructions" style="padding: 1rem 0;">
                    <!-- Instructions will be shown here -->
                </div>
                <button class="btn btn-primary" onclick="closeInstallModal()">–†–∞–∑–±—Ä–∞—Ö</button>
            </div>
        </div>

        <!-- Child Code Modal -->
        <div class="modal" id="childCodeModal">
            <div class="modal-content">
                <h2>üë∂ –ö–æ–¥ –Ω–∞ –¥–µ—Ç–µ—Ç–æ</h2>
                <p style="margin: 1rem 0;">–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ —Ç–æ–∑–∏ –∫–æ–¥ –∑–∞ –¥–∞ —Å–ø–æ–¥–µ–ª—è—Ç–µ –¥–∞–Ω–Ω–∏ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</p>
                <div style="background: #f0f0f0; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color); text-align: center; font-family: monospace;" id="childCodeDisplay">...</div>
                </div>
                <p style="font-size: 0.85rem; color: var(--text-light); text-align: center;">
                    –í—ä–≤–µ–¥–µ—Ç–µ —Å—ä—â–∏—è –∫–æ–¥ –Ω–∞ –¥—Ä—É–≥–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∑–∞ —Å–ø–æ–¥–µ–ª–µ–Ω–∞ –±–∞–∑–∞
                </p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 1.5rem;">
                    <button class="btn btn-primary" onclick="copyChildCode()">üìã –ö–æ–ø–∏—Ä–∞–π</button>
                    <button class="btn btn-secondary" onclick="changeChildCode()">‚úèÔ∏è –°–º–µ–Ω–∏ –∫–æ–¥</button>
                    <button class="btn btn-secondary" onclick="exportData()">‚¨áÔ∏è –ï–∫—Å–ø–æ—Ä—Ç</button>
                    <label for="importFile" class="btn btn-secondary" style="text-align: center; cursor: pointer;">‚¨ÜÔ∏è –ò–º–ø–æ—Ä—Ç</label>
                    <input type="file" id="importFile" accept="application/json" style="display:none" onchange="importData(this.files[0])" />
                </div>
                <button class="btn btn-secondary" onclick="closeChildCodeModal()" style="margin-top: 0.5rem; width: 100%;">–ó–∞—Ç–≤–æ—Ä–∏</button>
            </div>
        </div>
    </div>

    <script src="app_v2.js?v=6"></script>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>

